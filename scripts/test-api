#!/bin/bash
# Test script for API server integration tests

# Get project root and activate venv
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_ROOT="$( cd "$SCRIPT_DIR/.." && pwd )"

if [ -f "$PROJECT_ROOT/venv/bin/activate" ]; then
    source "$PROJECT_ROOT/venv/bin/activate"
fi

cd "$PROJECT_ROOT"

# Install test dependencies if needed
echo "ğŸ“¦ Checking test dependencies..."
pip install -q pytest pytest-asyncio httpx 2>/dev/null || true

# Run tests
echo "ğŸ§ª Running API integration tests..."
cd api-server
pytest tests/test_api.py -v --tb=short

exit_code=$?

if [ $exit_code -eq 0 ]; then
    echo "âœ… All tests passed!"
else
    echo "âŒ Some tests failed. See output above."
fi

exit $exit_code