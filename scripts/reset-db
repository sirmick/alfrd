#!/bin/bash
# Reset ALFRD database with new schema

# Get project root (scripts folder parent)
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_ROOT="$( cd "$SCRIPT_DIR/.." && pwd )"

# Activate venv if it exists
if [ -f "$PROJECT_ROOT/venv/bin/activate" ]; then
    source "$PROJECT_ROOT/venv/bin/activate"
fi

cd "$PROJECT_ROOT"

echo "‚ö†Ô∏è  WARNING: This will delete the existing database and create a new one."
echo "   All existing documents will be lost."
echo ""
read -p "Continue? (yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "Aborted."
    exit 0
fi

# Backup existing database if it exists
if [ -f "data/alfrd.db" ]; then
    BACKUP_NAME="data/alfrd.db.backup.$(date +%Y%m%d_%H%M%S)"
    echo "üì¶ Backing up existing database to $BACKUP_NAME"
    cp "data/alfrd.db" "$BACKUP_NAME"
fi

# Delete database
rm -f data/alfrd.db

# Initialize new database
echo "üîß Creating new database with updated schema..."
./scripts/init-db

echo ""
echo "‚úÖ Database reset complete!"
echo "   You can now add documents and run the processor."